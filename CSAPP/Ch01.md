计算机系统：硬件和系统软件

# 信息
> [!PDF|yellow] [[CSAPP-3th-ZH-OCR.pdf#page=38&selection=414,2,420,1&color=yellow|CSAPP-3th-ZH-OCR, p.38]]
> > 只由 ASCII 字符构成的文件称为文本文件，所有其他文件都称为二进制文件

系统中的信息是由一串比特表示的

区分不同数据对象的唯一方法是读取对象时的上下文

# 编译

目标程序（可执行目标文件）二进制

![[CSAPP-3th-ZH-OCR.pdf#page=39&rect=26,252,459,331&color=yellow|CSAPP-3th-ZH-OCR, p.39]]

编译系统：预处理器、编译器、汇编器、链接器

# 系统的硬件组成

![[CSAPP-3th-ZH-OCR.pdf#page=42&rect=108,382,419,619&color=yellow|CSAPP-3th-ZH-OCR, p.42]]

## 总线

贯穿整个系统的电子管道

定长字节块

## I/O Devices

控制器：设备本身或 1 系统主板上的芯片组

适配器：插在主板插槽上的卡

## 主存

DRAM

从零开始的线性字节数组，每个字节有唯一的地址（数组索引）

## 处理器

CPU：解释/执行储存在主存中指令的引擎

PC（程序计数器），大小为一个字的寄存器，指向主存中某条机器语言指令

指令集架构：定义了处理器执行指令时的行为

寄存器文件：有一些单个字长的寄存器组成，每个寄存器有唯一的名字

ALU：算术/逻辑单元，计算新的数据和地址

![[CSAPP-3th-ZH-OCR.pdf#page=43&rect=39,468,446,576&color=yellow|CSAPP-3th-ZH-OCR, p.43]]

微体系结构，现代优化

# 程序的运行

![[CSAPP-3th-ZH-OCR.pdf#page=43&rect=72,33,395,271&color=yellow|CSAPP-3th-ZH-OCR, p.43]]

DMA：直接存储器存取

![[CSAPP-3th-ZH-OCR.pdf#page=44&rect=77,352,440,587&color=yellow|CSAPP-3th-ZH-OCR, p.44]]

# 高速缓存

主存与处理器之间有速度差异

高速缓存存储器（cache memory），暂存处理器近期可能需要的信息

L1、L2、L3 高速缓存：静态随机访问存储器（SRAM）

L1：处理器芯片上

L2：专用总线连接到处理器

高速缓存的局部性原理：程序具有访问局部区域里的数据和代码的趋势

# 存储设备层次结构

![[CSAPP-3th-ZH-OCR.pdf#page=46&rect=60,365,453,605&color=yellow|CSAPP-3th-ZH-OCR, p.46]]

# 操作系统管理硬件

操作系统：

1. 安全：防止硬件被失控应用软件滥用
2. 接口、可移植：向应用软件提供简单一致的机制来控制复杂而不相同的低级硬件设备
## 进程
> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=47&selection=361,0,361,22|CSAPP-3th-ZH-OCR, p.47]]
> > 进程是操作系统对一个正在运行的程序的一种抽象

> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=47&selection=362,21,365,12|CSAPP-3th-ZH-OCR, p.47]]
> > 并发运行，则是说一个进程的指令和另一个进程的指令是交错执行的

> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=47&selection=374,21,375,4|CSAPP-3th-ZH-OCR, p.47]]
> > 操作系统实现这种交错执行的机制称为上下文切换

上下文：进程运行所需的所有状态信息，这包括程序计数器（PC）、寄存器文件和主存的内容等

上下文切换：操作系统将控制权由当前进程转移给新进程 $\implies$ 保存当前进程的上下文，恢复新进程的上下文

由内核（kernel）进行管理 $\implies$ 内核是操作系统代码常驻主存的部分

> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=48&selection=135,16,136,18|CSAPP-3th-ZH-OCR, p.48]]
> > 注意，内核不是一个独立的进程。相反，它是系统管理全部进程所用代码和数据结构的集合。

 当一个进程需要执行系统调用或发生中断时，控制权将转移给内核，由内核负责处理该系统调用或中断事件。

## 线程
> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=48&selection=277,30,279,7|CSAPP-3th-ZH-OCR, p.48]]
> > 一个进程实际上可以由多个称为线程的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据

## 虚拟内存
> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=48&selection=307,0,311,1|CSAPP-3th-ZH-OCR, p.48]]
> > 虚拟内存是一个抽象概念，它为每个进程提供了一个假象，即每个进程都在独占地使用主存。

每个进程看到的内存都是一致的：虚拟地址空间

![[CSAPP-3th-ZH-OCR.pdf#page=49&rect=92,371,356,619|CSAPP-3th-ZH-OCR, p.49]]

## 文件

文件是字节序列

> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=50&selection=23,14,31,1|CSAPP-3th-ZH-OCR, p.50]]
> > 每个 I/O 设备，包括磁盘、键盘、显示器，甚至网络，都可以看成是文件。

> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=50&selection=42,22,47,2|CSAPP-3th-ZH-OCR, p.50]]
> > 向应用程序提供了一个统一的视图，来看待系统中可能含有的所有各式各样的 I/O 设备

# 网络通信

![[CSAPP-3th-ZH-OCR.pdf#page=51&rect=77,366,381,603|CSAPP-3th-ZH-OCR, p.51]]

 网络可以看作是一个特殊的 I/O 设备，使计算机系统之间能够交换信息

# 软件与硬件
> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=52&selection=12,9,13,11|CSAPP-3th-ZH-OCR, p.52]]
> > 系统是硬件和系统软件互相交织的集合体，它们必须共同协作以达到运行应用程序的最终目的

# Amdahl 定律

若系统执行某应用程序需要时间为 $T_{\text{old}}$。假设系统某部分所需执行时间与该时间的比例为 $\alpha$，而该部分性能提升比例为 $k$。即该部分初始所需时间为 $\alpha T_{\text{old}}$，现在所需时间为 $(\alpha T_{\text{old}}) / k$。因此，总的执行时间应为 $$T_{\text{new}} = (1-\alpha)T_{\text{old}} + (\alpha T_{\text{old}})/k = T_{\text{old}}[(1-\alpha) + \alpha/k]$$

 由此，可以计算加速比 S = $T_{\text{old}}/T_{\text{new}}$ 为 $$S = \frac{1}{(1-\alpha) + \alpha/k} $$

> [!PDF|] [[CSAPP-3th-ZH-OCR.pdf#page=52&selection=177,0,177,29|CSAPP-3th-ZH-OCR, p.52]]
> > 要想显著加速整个系统，必须提升全系统中相当大的部分的速度。

# 并发与并行

并发：一个同时具有多个活动的系统

并行：用并发来使一个系统运行得更快

## 线程级并发

通过在单个进程中运行多个线程，允许多个控制流在同一程序中同时执行，从而实现更高效的计算资源利用

这是一种模拟的并发，实际上是计算机在进程间快速切换

多核处理器：多个 CPU 集成在一个集成电路芯片上

![[CSAPP-3th-ZH-OCR.pdf#page=54&rect=115,332,396,604|CSAPP-3th-ZH-OCR, p.54]]

超线程（同时多线程）：允许一个 CPU 执行多个控制流（e.g. 在一个物理核心上，模拟出两个逻辑核心）

## 指令级并行

指令级并行：现代处理器同时执行多条指令

流水线 $\implies$ 超标量处理器：处理器达到比一个周期一条指令更快的执行速率

## 单指令、多数据并行（SIMD）

允许一条指令产生多个并行执行的操作

# 抽象

![[CSAPP-3th-ZH-OCR.pdf#page=55&rect=73,80,380,226|CSAPP-3th-ZH-OCR, p.55]]

# 小结

![[CSAPP-3th-ZH-OCR.pdf#page=56&rect=40,406,472,582|CSAPP-3th-ZH-OCR, p.56]]
